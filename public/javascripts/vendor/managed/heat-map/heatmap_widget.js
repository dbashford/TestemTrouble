(function () {
var __hasProp={}.hasOwnProperty;define('berico/heatmap_widget',["leaflet","leaflet_draw","leaflet_heatmap"],function(){var t,exports,e;return exports={},e=function(t){var e,a,r,n,l,o,s,i,h,p;for(r=this,a=[],this._maxValue=null!=(i=t.max)?i:0,h=t.data,n=0,o=h.length;o>n;n++)e=h[n],a.push(new L.LatLng(e.lat,e.lon)),null==t.max&&(r._maxValue=Math.max(r._maxValue,e.value));for(this._bounds=new L.LatLngBounds(a),this._quad=new QuadTree(this._boundsToQuery(this._bounds),!1,6,6),p=t.data,l=0,s=p.length;s>l;l++)e=p[l],r._quad.insert({x:e.lon,y:e.lat,value:e.value});return this.redraw()},L.TileLayer.HeatMap.prototype.setData=e,t=function(){function t(){this.map=null,this.handlers={},this.bboxLayer=null,this.drawnItems=null,this.bboxRectOpts={stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},this.leafletMapOpts={center:[0,0],zoom:0,crs:L.CRS.EPSG4326},this.heatmapLayerOpts={radius:{value:20,absolute:!1},opacity:.8,minOpacity:0,gradient:{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}}}return t.prototype.on=function(t,e){return null==this.handlers[t]&&(this.handlers[t]=[]),this.handlers[t].push(e)},t.prototype.setHeatmapData=function(t,e){var a;return a={data:t},null!=e&&(a.max=e),this.heatmapLayer.setData(a)},t.prototype.bbox=function(t,e,a,r){var n,l,o,s,i;return null!=this.bboxLayer&&(this.drawnItems.removeLayer(this.bboxLayer),this.bboxLayer=null),o=new L.LatLng(t,e),i=new L.LatLng(a,r),n=new L.LatLngBounds(i,o),s=new L.Rectangle(n,this.bboxRectOpts),s.addTo(this.drawnItems),this.bboxLayer=s,l={northEast:{lat:t,lng:e},southWest:{lat:a,lng:r}},this._publish("bboxDrawn",l)},t.prototype.deleteBbox=function(){return null!=this.bboxLayer?this._publishBBoxDeletedEvent():void 0},t.prototype.invalidateSize=function(){return null!=this.map?this.map.invalidateSize():void 0},t.prototype.getMap=function(){return this.map},t.prototype.draw=function(t){var e,a,r,n,l,o,s,i,h,p,u,d,y,m,b,f,v,c,w;if(null==t.el)throw new Error("Please provide a value for the [el] option");if(null==t.mapUrl)throw new Error("Please provide a value for the [mapUrl] option");if(null==t.serverDefs)throw new Error("Please provide a value for the [serverDefs] option");if(null!=t.leafletImgPath&&(L.Icon.Default.imagePath=t.leafletImgPath),null!=t.heatmapOpacity&&(this.heatmapLayerOpts.opacity=t.heatmapOpacity),null!=t.heatmapMinOpacity&&(this.heatmapLayerOpts.minOpacity=t.heatmapMinOpacity),null!=t.heatmapGradient&&(this.heatmapLayerOpts.gradient=t.heatmapGradient),null!=t.leafletMapOpts){v=t.leafletMapOpts;for(h in v)__hasProp.call(v,h)&&(y=v[h],this.leafletMapOpts[h]=y)}if(i=null!=(c=t.layersNoWrap)?c:!1,this.heatmapLayer=L.TileLayer.heatMap(this.heatmapLayerOpts),null!=this.leafletMapOpts.layers?this.leafletMapOpts.layers.push(this.heatmapLayer):this.leafletMapOpts.layers=[this.heatmapLayer],this.map=L.map(t.el,this.leafletMapOpts),p={},e={},p.heat=this.heatmapLayer,null!=t.serverDefs.layers)for(w=t.serverDefs.layers,n=b=0,f=w.length;f>b;n=++b)o=w[n],a=o.id,u=o.requestType,m=o.version,l=o.label,d=L.tileLayer(""+t.mapUrl+"/query?request="+u+"&channel="+a+"&version="+m+"&x={x}&y={y}&z={z}",{noWrap:i,minZoom:1,maxZoom:16}).addTo(this.map),"ImageryMaps"===u?e[l]=d:p[l]=d;return s=L.control.layers(e,p).addTo(this.map),this.drawnItems=new L.FeatureGroup,this.map.addLayer(this.drawnItems),r=new L.Control.Draw({draw:{polyline:!1,polygon:!1,circle:!1,marker:!1},edit:{featureGroup:this.drawnItems}}),this.map.addControl(r),this._registerToDrawEvents(),this._registerToMoveEvents()},t.prototype._registerToMoveEvents=function(){var t=this;return this.map.on("moveend",function(e){return t._publish("mapMoveend",e)})},t.prototype._registerToDrawEvents=function(){var t=this;return this.map.on("draw:edited",function(){return null!=t.bboxLayer?t._publishBBoxDrawnEvent():void 0}),this.map.on("draw:deleted",function(){return null!=t.bboxLayer?t._publishBBoxDeletedEvent():void 0}),this.map.on("draw:drawstart",function(){return null!=t.bboxLayer?t._publishBBoxDeletedEvent():void 0}),this.map.on("draw:created",function(e){return t.bboxLayer=e.layer,t._publishBBoxDrawnEvent(),t.drawnItems.addLayer(t.bboxLayer)})},t.prototype._publishBBoxDrawnEvent=function(){var t,e;return t=this.bboxLayer.getBounds(),e={northEast:{lat:t.getNorth(),lng:t.getEast()},southWest:{lat:t.getSouth(),lng:t.getWest()}},this._publish("bboxDrawn",e)},t.prototype._publishBBoxDeletedEvent=function(){return this.drawnItems.removeLayer(this.bboxLayer),this._publish("bboxDeleted"),this.bboxLayer=null},t.prototype._publish=function(t,e){var a,r,n,l,o;if(null!=this.handlers[t]){for(l=this.handlers[t],o=[],r=0,n=l.length;n>r;r++)a=l[r],o.push(a(e));return o}},t}(),exports.Widget=t,exports});define(['berico/heatmap_widget'], function(lib) {
  return lib;
});
})()